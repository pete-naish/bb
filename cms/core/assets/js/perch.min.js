if(typeof Perch=="undefined"){Perch={};Perch.UI={};Perch.Apps={}}Perch.UI.Global=function(){var e=!1,t=!1,n=3e5,r,i=function(){$("body").addClass("js");document.all&&document.querySelector&&!document.addEventListener&&(r=!0);h();p();l();c();s();o();u();y();b();r||d();w();g()},s=function(){$("a.assist, a.draft-preview").click(function(e){e.preventDefault();window.open($(this).attr("href"))})},o=function(){$("p.alert.success")&&setTimeout("$('p.alert.success').selfHealingRemove()",5e3)},u=function(){$(window).on("load",function(){a();f()});$(window).on("resize",function(){e=!0;setTimeout(function(){if(e){a();e=!1}},1e3);f()})},a=function(){if(r)return;var e=$(".magnetic-save-bar p.submit");if(e.length&&!e.hasClass("nonstick")){var t=$(window),n=e.position().top,i=e.outerHeight(!0),s=t.height(),o=$("p.alert");o&&(n-=o.outerHeight(!0));if($("body").height()>s){t.scroll(function(){var r=t.scrollTop()+s-i-70;if(n>r){e.addClass("stuck");e.parents("form").addClass("with-stuck");var o=r-n;if(-o<50)var u=.005*-o/50*100;else var u=.5;e.hasClass("error")?e.css("background-color","rgba(179, 64, 64, "+u+")"):e.css("background-color","rgba(191, 191, 191, "+u+")")}else{e.removeClass("stuck");e.parents("form").removeClass("with-stuck");e.css("background-color","rgba(255, 255, 255, 1)")}});t.scroll()}}},f=function(){var e=$("textarea.autowidth, .editor-wrap");e.length&&e.each(function(e,t){var n=$(t),r=n.parents("div.field"),i=r.find("label:first");if(r&&i){var s=r.innerWidth()-i.outerWidth();s>200&&n.width(s-40)}})},l=function(){var e=$("body"),t=!1;$(window).on("scroll",function(t){e.scrollTop()>0?e.addClass("scrolled"):e.removeClass("scrolled")})},c=function(){var e=$(".smartbar");if(e.length){var t=e.find(".filter");t.on("click","li a",function(e){var t=$(this).parent("li"),n=t.parents("ul");(!n.hasClass("open")||t.is(":first-child"))&&e.preventDefault();if(n.hasClass("open")){n.removeClass("open");n.parent("li").find(".proxy").remove()}else{n.parent("li").append($('<p class="proxy">.</p>'));n.addClass("open")}});t.each(function(e,t){var n=$(t);n.css("width",n.find("li:first-child").outerWidth())})}},h=function(){var e="cmssb",t=$("body");$.cookie(e)==1&&t.addClass("sidebar-closed").removeClass("sidebar-open");$(".topbar").append($('<a href="#" id="sidebar-toggle" class="icon"><span>'+Perch.Lang.get("Toggle sidebar")+"</span></a>"));var n=$("#sidebar-toggle");n.on("click",function(n){n.preventDefault();t.toggleClass("sidebar-closed").toggleClass("sidebar-open");t.hasClass("sidebar-closed")?$.cookie(e,1,{path:"/"}):$.cookie(e,0,{path:"/"});f();$(window).trigger("perch.sidebar-toggle")})},p=function(){var e=$("#appmenu ul.appmenu"),t=e.find("li");if(t.length>1&&!r){e.addClass("menu");var n=$("#appmenu");n.addClass("menucont");var i=e.find("li.selected a:not(.add)").text();if(i)var s=!0;else{i=Perch.Lang.get("Apps");var s=!1}var o=$('<a class="trigger" href="#">'+i+"</a>");e.before(o).hide();s&&o.parent("li").addClass("selected");e.prepend($('<li class="dumb"><a class="trigger" href="#">'+i+'</a></li><li class="spaceinvader"></li>'));n.hover(function(){e.show()},function(){e.hide()});o.click(function(t){t.preventDefault();e.show()});e.find("a.trigger").click(function(t){t.preventDefault();e.hide()})}$(".topbar .mainnav").show()},d=function(){$("a.inline-delete").click(function(e){e.preventDefault();var t=$(this),n=Perch.Lang.get("Delete this item?");t.attr("data-msg")&&(n=t.attr("data-msg"));v(e,n,function(){$.post(t.attr("href"),{_perch_ajax:1,formaction:"delete",token:Perch.token},function(e){window.location=e})},function(){m()})})},v=function(e,n,r,i){t&&m();var s=$(e.target);t=$('<div id="confirm-dialogue"><p>'+n+'</p><a href="#" class="ok">'+Perch.Lang.get("Yes")+'</a><a href="#" class="cancel">'+Perch.Lang.get("No")+'</a><span class="speak"></span></div>');$(".main").append(t);t.css({top:s.offset().top-(t.outerHeight()+10),left:s.offset().left-t.outerWidth()/2-36}).fadeIn("fast");t.find("a.ok").click(function(e){e.preventDefault();r();m()});t.find("a.cancel").click(function(e){e.preventDefault();i();m()})},m=function(){t&&t.fadeOut("fast",function(){t=!1})},g=function(){$("form").length&&setInterval(function(){$.get(Perch.path+"/core/inc/keepalive.php")},n)},y=function(){$("form .checkboxes").length&&$("form .checkboxes").on("change","input[type=checkbox]",function(){var e=$(this);e.is(":checked")&&(e.hasClass("single")?e.parents(".checkboxes").find("input[type=checkbox]:not(.single, :disabled)").attr("checked",!1):e.parents(".checkboxes").find("input[type=checkbox].single").attr("checked",!1))})},b=function(){var e=$("form input[data-urlify]");e.length&&e.parents("form").on("change","input[data-urlify]",function(){var e=$(this),t=$("#"+e.attr("data-urlify"));if(t.length){var n=e.val();n=n.replace(/[^\w-\s]/gi,"");n=n.replace(/\s/gi,"-");n=n.replace(/-{2,}/gi,"-");n=n.replace(/-$/,"");n=n.toLowerCase();t.val(n)}});var e=$("form input[data-copy]");e.length&&e.parents("form").on("change","input[data-copy]",function(){var e=$(this),t=$("#"+e.attr("data-copy"));if(t.length){var n=e.val();t.val(n)}})},w=function(){var e=$("#dashboard");e.length&&e.sortable({handle:"h2",cursor:"move",stop:function(){var t=[];e.find(".widget[data-app]").each(function(e,n){t.push($(n).attr("data-app"))});$.post(window.location,{_perch_ajax:1,formaction:"reorder",token:Perch.token,order:t.join(",")},function(e){Perch.token=e})}})};return{init:i,resizeFields:f}}();Perch.Apps.Content=function(){var e=[],t="cmscl",n=function(){i();r()},r=function(){var e=$("ul.reorder");e.length&&e.sortable({stop:function(){e.find("input").each(function(e,t){$(t).val(e+1e3)})}})},i=function(){var e=$("#content-list");if(e.length){var t=$(window);e.on("click","a.toggle",function(e){var n=$(e.target);n.attr("href",n.attr("href")+"#sc"+t.scrollTop())});var n=window.location.hash;if(n.length){var r=n.replace("#sc","");t.scrollTop(r)}}};return{init:n}}();Perch.Lang=function(){var e={},t=function(t){e=t},n=function(t){return e[t]?e[t]:t};return{init:t,get:n}}();jQuery.fn.selfHealingRemove=function(e,t){if(jQuery.isFunction(e)){t=e;e={}}else e=jQuery.extend({speed:"slow"},e);return this.each(function(){var n=jQuery(this);n.animate({opacity:0},e.speed,function(){n.slideUp(e.speed,function(){n.remove();jQuery.isFunction(t)&&t()})})})};jQuery.fn.textWidth=function(){var e=$(this),t=e.html(),n="<span>"+t+"</span>";e.html(n);var r=$(this).find("span:first").width();e.html(t);return r};jQuery.cookie=function(e,t,n){if(arguments.length>1&&String(t)!=="[object Object]"){n=jQuery.extend({},n);if(t===null||t===undefined)n.expires=-1;if(typeof n.expires=="number"){var r=n.expires,i=n.expires=new Date;i.setDate(i.getDate()+r)}t=String(t);return document.cookie=[encodeURIComponent(e),"=",n.raw?t:encodeURIComponent(t),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")}n=t||{};var s,o=n.raw?function(e){return e}:decodeURIComponent;return(s=(new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)")).exec(document.cookie))?o(s[1]):null};jQuery(function(e){Perch.UI.Global.init();for(var t in Perch.Apps)Perch.Apps[t].init()});